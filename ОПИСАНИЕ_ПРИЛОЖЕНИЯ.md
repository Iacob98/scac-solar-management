# SCAC - Система управления проектами солнечных установок

## Общий обзор

SCAC (Solar Control And Construction) - это комплексная веб-платформа для автоматизации проектов по установке солнечных панелей. Система предназначена для управления несколькими компаниями по установке солнечных батарей, их проектами, клиентами и выставлением счетов через интеграцию с Invoice Ninja.

## Архитектура системы

### Технологический стек
- **Frontend**: React 18 с TypeScript, Vite, Tailwind CSS, shadcn/ui
- **Backend**: Node.js, Express.js, TypeScript
- **База данных**: PostgreSQL с Drizzle ORM
- **Аутентификация**: Replit Auth с OpenID Connect
- **Интеграция**: Invoice Ninja API для выставления счетов

### Основные компоненты
- Управление пользователями и ролями
- Мультифирменная архитектура
- Управление проектами и статусами
- Система выставления счетов
- Файловое хранилище
- Отчетность и аналитика

## Функциональные возможности

### 1. Система аутентификации и пользователей

#### Роли пользователей:
- **Администратор**: Полный доступ ко всем функциям системы
- **Руководитель проекта**: Ограниченный доступ к назначенным фирмам

#### Функции:
- Вход через Replit Auth
- Управление профилем пользователя
- Загрузка аватара профиля
- Редактирование личных данных
- Система тестовых пользователей для разработки

### 2. Управление фирмами

#### Для администраторов:
- Создание новых фирм
- Редактирование данных фирм
- Интеграция с Invoice Ninja API
- Автоматическое заполнение данных компании
- Тестирование подключения к Invoice Ninja

#### Данные фирмы:
- Основная информация (название, адрес, телефон)
- Настройки Invoice Ninja (URL, токен)
- Налоговые настройки
- Банковские реквизиты

### 3. Управление клиентами

#### Функции:
- Добавление новых клиентов
- Редактирование данных клиентов
- Просмотр истории проектов клиента
- Связь с проектами

#### Данные клиента:
- Контактная информация
- Адрес установки
- Данные для выставления счетов
- История взаимодействий

### 4. Управление бригадами

#### Функции:
- Создание и редактирование бригад
- Назначение бригад на проекты
- Управление составом бригады
- Отслеживание загрузки бригад

#### Данные бригады:
- Название бригады
- Состав участников
- Специализация
- Текущие назначения

### 5. Управление проектами

#### Статусы проектов:
- **Планирование**: Начальная стадия проекта
- **В работе**: Активное выполнение
- **Завершен**: Работы закончены
- **Выставлен счет**: Счет создан в Invoice Ninja
- **Оплачен**: Платеж получен

#### Функции проекта:
- Создание и редактирование проектов
- Назначение бригад
- Отслеживание прогресса
- Управление статусами
- Планирование дат начала и окончания работ

#### Данные проекта:
- Основная информация
- Данные клиента и установки
- Техническая информация о системе
- Сроки выполнения
- Назначенная бригада
- Связанные услуги и счета

### 6. Управление услугами

#### Функции:
- Добавление услуг к проектам
- Редактирование цен и описаний
- Блокировка изменений после выставления счета
- Категоризация услуг

#### Ограничения:
- Услуги заблокированы для редактирования после создания счета
- Защита от случайных изменений в оплаченных проектах

### 7. Система выставления счетов

#### Интеграция с Invoice Ninja:
- Автоматическое создание счетов
- Синхронизация статусов оплаты
- Скачивание PDF счетов
- Передача данных клиента и услуг

#### Функции:
- Создание счетов из проектов
- Отметка счетов как оплаченных
- Двусторонняя синхронизация статусов
- Автоматическое сохранение PDF файлов

### 8. Файловое хранилище

#### Типы файлов:
- **Файлы проекта**: Документы, связанные с проектом
- **Отчеты**: Технические отчеты и оценки
- **Счета**: PDF файлы счетов из Invoice Ninja
- **Документы**: Общие документы
- **Изображения**: Фотографии и схемы
- **Профиль**: Аватары пользователей

#### Функции:
- Прямая загрузка файлов с компьютера
- Автоматическая категоризация
- Безопасный доступ к файлам
- Автоматическое сохранение PDF счетов
- Предварительный просмотр изображений
- Ограничения по размеру и типу файлов

### 9. Отчеты проектов

#### Функции:
- Создание отчетов с оценками
- Система звездных рейтингов (1-5 звезд)
- Редактирование и удаление отчетов
- Связь отчетов с проектами

#### Данные отчета:
- Название отчета
- Описание
- Рейтинг (звезды)
- Дата создания
- Автор отчета

### 10. История проектов

#### Отслеживаемые события:
- Создание проекта
- Изменение статуса
- Назначение бригады
- Создание счетов
- Изменение статуса оплаты
- Добавление/удаление файлов
- Создание/изменение отчетов

#### Функции:
- Полная история изменений
- Указание автора изменений
- Временные метки
- Детальные описания действий

### 11. Главная панель и аналитика

#### Статистические данные:
- Количество активных проектов
- Общее количество клиентов
- Количество доступных бригад
- Статусы проектов

#### Быстрые действия:
- Создание нового проекта
- Добавление клиента
- Создание бригады
- Переход к управлению фирмами

### 12. Расширенные функции

#### Мультифирменность:
- Работа с несколькими компаниями
- Изоляция данных между фирмами
- Переключение контекста фирмы
- Ролевое разграничение доступа

#### Интернационализация:
- Полная русская локализация
- Корректное форматирование валют (EUR)
- Локализованные форматы дат
- Русские названия и описания

#### Безопасность:
- Аутентификация через Replit Auth
- Ролевое разграничение доступа
- Защищенные API эндпоинты
- Безопасное хранение файлов

## Технические особенности

### База данных
- PostgreSQL с полной нормализацией
- Drizzle ORM для типобезопасности
- Автоматические миграции
- Связи между таблицами с внешними ключами

### API архитектура
- RESTful API эндпоинты
- TypeScript типизация
- Валидация данных через Zod схемы
- Обработка ошибок и логирование

### Frontend архитектура
- React с TypeScript
- TanStack Query для управления состоянием сервера
- Wouter для маршрутизации
- Shadcn/ui компоненты с Tailwind CSS

### Интеграции
- Invoice Ninja API v5
- Replit Auth OpenID Connect
- Файловая система для хранения документов
- WebSocket поддержка для реального времени

## Развертывание и настройка

### Переменные окружения:
- `DATABASE_URL`: Подключение к PostgreSQL
- `SESSION_SECRET`: Ключ шифрования сессий
- `ISSUER_URL`: URL OpenID Connect провайдера

### Команды:
- `npm run dev`: Запуск в режиме разработки
- `npm run build`: Сборка для продакшена
- `npm run db:push`: Применение изменений схемы БД

## Заключение

SCAC представляет собой полнофункциональную систему управления проектами солнечных установок с современной архитектурой, интеграцией с внешними сервисами и удобным пользовательским интерфейсом. Система обеспечивает полный цикл управления проектами от планирования до завершения и оплаты.