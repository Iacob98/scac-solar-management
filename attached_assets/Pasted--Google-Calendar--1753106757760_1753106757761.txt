### üîó ‚ÄØ–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google‚ÄØCalendar‚ÄØ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏

*(—É—á—Ç–µ–Ω—ã —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã: –∫–∞–∂–¥–æ–º—É —á–ª–µ–Ω—É –±—Ä–∏–≥–∞–¥—ã –µ—Å—Ç—å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è‚ÄØGoogle‚Äë–ø–æ—á—Ç–∞; —É —Ñ–∏—Ä–º—ã –Ω—É–∂–µ–Ω –æ–±—â–∏–π ¬´–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π¬ª –∫–∞–ª–µ–Ω–¥–∞—Ä—å; Project‚ÄØLeiter –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –±—Ä–∏–≥–∞–¥—ã‚ÄØ–∏ –∏—Ö —Å–æ–±—ã—Ç–∏—è)*

---

## 1.‚ÄØ–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

| –¢–∞–±–ª–∏—Ü–∞            | –ù–æ–≤—ã–µ/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –ø–æ–ª—è                                                                | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                      |
| ------------------ | ------------------------------------------------------------------------------------ | ----------------------------------------------- |
| **firms**          | `gcal_master_id` (—Å—Ç—Ä–æ–∫–∞)                                                            | ID –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Ñ–∏—Ä–º—ã ¬´–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã¬ª |
| **google\_tokens** | `firm_id`, `access_token`, `refresh_token`, `expiry`                                 | —Ö—Ä–∞–Ω–∏—Ç OAuth‚Äë—Ç–æ–∫–µ–Ω—ã —Ñ–∏—Ä–º—ã                       |
| **crews**          | `gcal_id` (—Å—Ç—Ä–æ–∫–∞)                                                                   | ID –∫–∞–ª–µ–Ω–¥–∞—Ä—è –±—Ä–∏–≥–∞–¥—ã                            |
| **crew\_members**  | `crew_id`, `member_email`                                                            | —Å–ø–∏—Å–æ–∫ e‚Äëmail —á–ª–µ–Ω–æ–≤ –±—Ä–∏–≥–∞–¥—ã (–¥–ª—è ACL)          |
| **calendar\_logs** | `timestamp`, `user_id`, `action`, `project_id`, `event_id`, `status`, `details json` | –∞—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å Google‚ÄëAPI                |

---

## 2.‚ÄØ–°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏¬†(–±–µ–∑ –∫–æ–¥–∞, —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞)

| Endpoint                                  | –î–µ–π—Å—Ç–≤–∏–µ                                                                                                                                           | –ü–æ—Ç–æ–∫ / –ø—Ä–æ–≤–µ—Ä–∫–∏                          |
| ----------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| **`POST /api/google/connect/:firm_id`**   | OAuth‚Äë–ø—Ä–æ—Ö–æ–¥; —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω—ã                                                                                                                     | ‚ñ∏ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω —Ñ–∏—Ä–º—ã                      |
| **`POST /api/firm/createMasterCalendar`** | –µ—Å–ª–∏ `gcal_master_id` –ø—É—Å—Ç ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç‚ÄØ`calendars.insert` (–Ω–∞–∑–≤–∞–Ω–∏–µ ¬´Projects ‚Äì {firm}¬ª), –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç ID                                             |                                           |
| **`POST /api/crew/createCalendar`**       | 1) —Å–æ–∑–¥–∞—ë—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å ¬´Crew‚ÄØ{‚Ññ} ‚Äì {firm}¬ª<br>2) –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç `gcal_id` –≤ `crews`<br>3) –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç¬†`crew_members` ‚Äì –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Ö¬†e‚Äëmail –≤ ACL ¬´reader¬ª | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —É —Ñ–∏—Ä–º—ã —É–∂–µ –µ—Å—Ç—å —Ç–æ–∫–µ–Ω     |
| **`POST /api/calendar/syncProject`**      | –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–π –º–µ—Ç–æ–¥:<br>‚Ä¢ insert / patch / delete –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ **–±—Ä–∏–≥–∞–¥—ã** –∏ **–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–º –∫–∞–ª–µ–Ω–¥–∞—Ä–µ**  | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ crew –∏ firm |
| **`POST /api/crew/updateMembers`**        | –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ e‚Äëmail; —Å–µ—Ä–≤–µ—Ä —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç ACL –∫–∞–ª–µ–Ω–¥–∞—Ä—è, –¥–æ–±–∞–≤–ª—è–µ—Ç/—É–¥–∞–ª—è–µ—Ç –∞–¥—Ä–µ—Å–∞                                                                 |                                           |

*–í—Å–µ –≤—ã–∑–æ–≤—ã –∫ Google¬†API –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `calendar_logs`.*

---

## 3.‚ÄØ–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å–æ–±—ã—Ç–∏—è (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω)

| –ü–æ–ª–µ —Å–æ–±—ã—Ç–∏—è Google¬†Calendar | –ó–Ω–∞—á–µ–Ω–∏–µ                                                              |
| ---------------------------- | --------------------------------------------------------------------- |
| **summary**                  | `–ú–æ–Ω—Ç–∞–∂: {ClientName}`                                                |
| **location**                 | `{client_address}`                                                    |
| **description**              | `–ü—Ä–æ–µ–∫—Ç #{project_id}\\n–ë—Ä–∏–≥–∞–¥–∞: {crew_name}\\n–°—Å—ã–ª–∫–∞: {URL_–ø—Ä–æ–µ–∫—Ç–∞}` |
| **start / end**              | `start_date 08:00`‚ÄÉ‚Üí‚ÄÉ`end_date 18:00`¬†<br>(Europe/Berlin)             |
| **colorId**                  | —Å–µ—Ä—ã–π‚ÄØ=‚ÄØin\_progress, –∑–µ–ª—ë–Ω—ã–π‚ÄØ=‚ÄØdone                                  |

---

## 4.‚ÄØ–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ UI

### 4.1 ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏—Ä–º—ã‚ÄØ‚Üí‚ÄØGoogle¬†Calendar¬ª

* –ö–Ω–æ–ø–∫–∞ **¬´–ü–æ–¥–∫–ª—é—á–∏—Ç—å Google¬ª** ‚Üí OAuth‚Äëpop‚Äëup.
* –ü–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞: —á–µ–∫‚Äë–±–æ–∫—Å ¬´–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∞—Å—Ç–µ—Ä‚Äë–∫–∞–ª–µ–Ω–¥–∞—Ä—å¬ª + –∫–Ω–æ–ø–∫–∞ ¬´–°–æ–∑–¥–∞—Ç—å¬ª.
* –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è `gcal_master_id` (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å¬ª).

### 4.2 ¬´–ë—Ä–∏–≥–∞–¥—ã¬ª

* –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ / —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –±—Ä–∏–≥–∞–¥—ã:

  * –ü–æ–ª–µ ¬´–ü–æ—á—Ç—ã —á–ª–µ–Ω–æ–≤¬ª (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π email‚Äëinput).
  * –ö–Ω–æ–ø–∫–∞ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å¬ª (–µ—Å–ª–∏ –Ω–µ—Ç gcal\_id).
  * –°—Ç–∞—Ç—É—Å‚Äë–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä ¬´Google‚ÄØ‚úÖ¬†/¬†‚ùå¬ª.

### 4.3 ¬´–ü—Ä–æ–µ–∫—Ç¬ª

* –ü–æ–ª–µ ¬´–ë—Ä–∏–≥–∞–¥–∞¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–Ω–∞—á–æ–∫ üìÖ, –µ—Å–ª–∏ —É –±—Ä–∏–≥–∞–¥—ã –µ—Å—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å (–∫–ª–∏–∫ ‚Üí –æ—Ç–∫—Ä–æ–µ—Ç Gcal).
* –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞—Ç/–±—Ä–∏–≥–∞–¥—ã —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `/api/calendar/syncProject`.

### 4.4 ¬´–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞¬ª

* –¢–∞–± ¬´–õ–æ–≥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è¬ª ‚Äì –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å–∏ `calendar_logs` (—Å–æ–∑–¥–∞–Ω–æ, –æ–±–Ω–æ–≤–ª–µ–Ω–æ, —É–¥–∞–ª–µ–Ω–æ).

---

## 5.‚ÄØ–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å             | –í–∏–¥–∏—Ç‚Ä¶                                          | –ú–æ–∂–µ—Ç‚Ä¶                              |
| ------------------------ | ----------------------------------------------- | ----------------------------------- |
| Project¬†Leiter           | —Ç–æ–ª—å–∫–æ –∫–∞–ª–µ–Ω–¥–∞—Ä–∏ –±—Ä–∏–≥–∞–¥, –≤—Ö–æ–¥—è—â–∏—Ö –≤ –µ–≥–æ –ø—Ä–æ–µ–∫—Ç—ã | –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è   |
| –ß–ª–µ–Ω—ã –±—Ä–∏–≥–∞–¥—ã (–ø–æ email) | —Ç–æ–ª—å–∫–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–≤–æ–µ–π –±—Ä–∏–≥–∞–¥—ã                  | *—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä*                   |
| –ê–¥–º–∏–Ω —Ñ–∏—Ä–º—ã              | –≤—Å–µ –∫–∞–ª–µ–Ω–¥–∞—Ä–∏ —Ñ–∏—Ä–º—ã, –º–∞—Å—Ç–µ—Ä‚Äë–∫–∞–ª–µ–Ω–¥–∞—Ä—å           | –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å / —É–¥–∞–ª–∏—Ç—å –ª—é–±–æ–µ —Å–æ–±—ã—Ç–∏–µ |

---

## 6.‚ÄØ–ü–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è (–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π)

```
 PL –º–µ–Ω—è–µ—Ç –¥–∞—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
         ‚îÇ
         ‚ñº
 backend ‚Üí /syncProject
         ‚îÇ
         ‚îú‚îÄ –µ—Å–ª–∏ project.status != cancelled
         ‚îÇ     ‚îú‚îÄ events.insert ( Crew calendar )
         ‚îÇ     ‚îî‚îÄ events.insert ( Master calendar )
         ‚îî‚îÄ log ‚Üí calendar_logs
```

*–û—Ç–º–µ–Ω–∞ / —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞*¬†‚Äî¬†`events.delete` –≤ –æ–±–µ–∏—Ö –∫–∞–ª–µ–Ω–¥–∞—Ä—è—Ö.

---

## 7.‚ÄØ–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏)

```
2025‚Äë08‚Äë04T09:12
user=pl88
action=create_event
project_id=312
event_id=ptkj5ddrd2aol12hiu58
status=success
details={
  "calendar":"crew_#A12",
  "start":"2025‚Äë08‚Äë10 08:00",
  "end":"2025‚Äë08‚Äë12 18:00"
}
```

---

## 8.‚ÄØ–ö–æ—Ä–æ—Ç–∫–æ –æ ¬´–∫—Ç–æ‚Äë–≤–∏–¥–∏—Ç‚Äë—á—Ç–æ¬ª

| –≠–ª–µ–º–µ–Ω—Ç                                          | –ö—Ç–æ –≤–∏–¥–∏—Ç                                                              |
| ------------------------------------------------ | ---------------------------------------------------------------------- |
| **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å ¬´Projects ‚Äì Firma‚ÄØX¬ª** | –ê–¥–º–∏–Ω —Ñ–∏—Ä–º—ã                                                            |
| **–ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—Ä–∏–≥–∞–¥—ã ¬´Crew‚ÄØA12¬ª**                 | –ê–¥–º–∏–Ω —Ñ–∏—Ä–º—ã, –≤—Å–µ —á–ª–µ–Ω—ã –±—Ä–∏–≥–∞–¥—ã (ACL), —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Project¬†Leiter‚Äô—ã |
| **–°–æ–±—ã—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞**                              | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–º–µ—â–µ–Ω–æ –≤ –¥–≤—É—Ö –∫–∞–ª–µ–Ω–¥–∞—Ä—è—Ö (–±—Ä–∏–≥–∞–¥—ã¬†+ –º–∞—Å—Ç–µ—Ä)           |

---

‚úÖ‚ÄØ–¢–µ–ø–µ—Ä—å –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é: —Ç–∞–±–ª–∏—Ü—ã, —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, UI‚Äë–∫–Ω–æ–ø–∫–∏, –ø—Ä–∞–≤–∞ –∏ –∂—É—Ä–Ω–∞–ª—ã. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Google¬†Meet –∏–ª–∏ –¥–≤—É—Ö—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)‚ÄØ‚Äî —Å–∫–∞–∂–∏, –¥–æ–±–∞–≤–∏–º.
