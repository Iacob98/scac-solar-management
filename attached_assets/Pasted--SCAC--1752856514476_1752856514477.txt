# SCAC‚Äë–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ –º–æ–Ω—Ç–∞–∂—É —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏, –±—Ä–∏–≥–∞–¥–∞–º–∏ –∏ —Ñ–∏—Ä–º–∞–º–∏.**
–§–æ—Ä–º–∞—Ç: –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

---

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–¶–µ–ª–∏ –∏ —Ä–æ–ª–∏](#1-—Ü–µ–ª–∏-–∏-—Ä–æ–ª–∏)
2. [–°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö](#2-—Å—Ö–µ–º–∞-–¥–∞–Ω–Ω—ã—Ö)
3. [–°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏](#3-—Å–µ—Ä–≤–µ—Ä–Ω—ã–µ-—Ñ—É–Ω–∫—Ü–∏–∏)
4. [–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Invoice¬†Ninja](#4-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ-—Å-invoice-ninja)
5. [UI –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è](#5-ui-–∏-–Ω–∞–≤–∏–≥–∞—Ü–∏—è)
6. [–õ–æ–≥–∏–∫–∞ –±–∏–∑–Ω–µ—Å‚Äë–ø—Ä–æ—Ü–µ—Å—Å–æ–≤](#6-–ª–æ–≥–∏–∫–∞-–±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤)
7. [–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è¬†–∏¬†–æ—Ç—á—ë—Ç—ã](#7-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è-–∏-–æ—Ç—á—ë—Ç—ã)
8. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å¬†–∏¬†–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ](#8-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## 1. –¶–µ–ª–∏ –∏ —Ä–æ–ª–∏

### üéØ –¶–µ–ª—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∫–æ–º–ø–∞–Ω–∏–∏‚Äë–ø–æ—Å—Ä–µ–¥–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≤–µ–¥—ë—Ç –º–æ–Ω—Ç–∞–∂ —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π —Ä–∞–∑–Ω—ã–º–∏ –±—Ä–∏–≥–∞–¥–∞–º–∏ –∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç —Å—á–µ—Ç–∞ (Invoice¬†Ninja) –∫–æ–Ω–µ—á–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º –æ—Ç –∏–º–µ–Ω–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∏—Ä–º.

### üë• –†–æ–ª–∏

| –†–æ–ª—å                    | –ü—Ä–∞–≤–∞                                                           | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                                                   |
| ----------------------- | --------------------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**       | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø: –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã, —Ñ–∏—Ä–º—ã, –±—Ä–∏–≥–∞–¥—ã, —Å—á—ë—Ç–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | –ú–æ–∂–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –æ–ø–ª–∞—Ç—É, –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∏–≥–∞–¥—ã/–∫–ª–∏–µ–Ω—Ç–æ–≤, –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–∏—Ä–º—ã –∏ Project¬†Leiter‚Äô–æ–≤ |
| **Project¬†Leiter (PL)** | –í–∏–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç—ã/–∫–ª–∏–µ–Ω—Ç–æ–≤ —Ç–æ–ª—å–∫–æ —Ç–µ—Ö —Ñ–∏—Ä–º, –∫ –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–∏–≤—è–∑–∞–Ω      | –°–æ–∑–¥–∞—ë—Ç/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç—ã, —É—Å–ª—É–≥–∏, —Ñ–∞–π–ª—ã; –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—á—ë—Ç                           |

---

## 2. –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

### 2.1 –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (PostgreSQL)

| –¢–∞–±–ª–∏—Ü–∞            | –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è                                                                                                                                               |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **firms**          | `id uuid PK`, `name`, `invoice_ninja_url`, `token`, `address`, `tax_id`, `logo_url`                                                                         |
| **users**          | `id uuid PK`, `role` (`admin`/`leiter`), `email`, `password_hash`                                                                                           |
| **user\_firms**    | `user_id` + `firm_id` (–º–Ω–æ–≥–∏–µ‚Äë–∫–æ‚Äë–º–Ω–æ–≥–∏–º)                                                                                                                    |
| **clients**        | `id serial PK`, `firm_id`, `ninja_client_id`, `name`, `email`, `address`, `phone`                                                                           |
| **crews**          | `id serial PK`, `firm_id`, `name`, `leader_name`, `phone`, `archived bool`                                                                                  |
| **projects**       | `id serial PK`, `firm_id`, `client_id`, `leiter_id`, `crew_id`, `start_date`, `end_date`, `status`, `team_number`, `notes`, `invoice_number`, `invoice_url` |
| **services**       | `id serial PK`, `project_id`, `product_key`, `description`, `price`, `quantity`, `is_custom`                                                                |
| **invoices**       | `id serial PK`, `project_id`, `invoice_id` (UUID Ninja), `invoice_number`, `invoice_date`, `due_date`, `total_amount`, `is_paid bool`                       |
| **project\_files** | `id serial PK`, `project_id`, `file_url`, `file_type` (`report_photo` / `acceptance` / `review`), `uploaded_at`                                             |
| **invoice\_queue** | `id serial PK`, `project_id`, `created_at`, `processed bool`                                                                                                |

> üîí **RLS**: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `user_id` –∏ `firm_id` –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü, –∫—Ä–æ–º–µ `firms` (—á—Ç–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω).

---

## 3. –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| Endpoint                       | –û–ø–∏—Å–∞–Ω–∏–µ               | –í—Ö–æ–¥                                          | –í—ã—Ö–æ–¥                |
| ------------------------------ | ---------------------- | --------------------------------------------- | -------------------- |
| `POST /api/project/create`     | –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç         | client\_id, firm\_id, dates, crew\_id         | project\_id          |
| `PUT /api/project/update`      | –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª—è –ø—Ä–æ–µ–∫—Ç–∞  | project\_id, patch‚Äë–æ–±—ä–µ–∫—Ç                     | OK                   |
| `POST /api/service/add`        | –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É —É—Å–ª—É–≥–∏ | project\_id, product\_key/ custom, price, qty | OK                   |
| `POST /api/crew/create`        | –ù–æ–≤–∞—è –±—Ä–∏–≥–∞–¥–∞          | firm\_id, name, etc.                          | crew\_id             |
| `DELETE /api/crew/archive`     | –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∏–≥–∞–¥—É   | crew\_id                                      | OK / error           |
| `POST /api/invoice/create`     | –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—á—ë—Ç      | project\_id                                   | invoice\_number, url |
| `PATCH /api/invoice/mark-paid` | –ü–æ–º–µ—Ç–∏—Ç—å –æ–ø–ª–∞—á–µ–Ω–Ω—ã–º    | invoice\_number                               | OK                   |
| `GET /api/catalog/products`    | –ö–∞—Ç–∞–ª–æ–≥ Ninja          | firm\_id                                      | –º–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤       |

*–í—Å—è –ª–æ–≥–∏–∫–∞ Invoice¬†Ninja –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, API‚Äë–∫–ª—é—á–∏ –Ω–µ –≤—ã—Ö–æ–¥—è—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç.*

---

## 4. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Invoice¬†Ninja

1. **/products** ‚Äì –∫—ç—à —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏, —Ö—Ä–∞–Ω–∏—Ç—Å—è per‚Äëfirm.
2. **/invoices (POST)** ‚Äì —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–∑ `services` + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:
   `custom_value1 = "PROJ-{project_id}", custom_value2 = "CREW-{crew_id}"`.
3. –û—Ç–≤–µ—Ç (`invoice_number`, `pdf_url`) –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –≤ **invoices** –∏ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ **projects**.

---

## 5. UI –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è

### 5.1 –û–±—â–∞—è –∫–æ–º–ø–æ–Ω–æ–≤–∫–∞

```
Top‚Äëbar: –ª–æ–≥–æ—Ç–∏–ø ‚Ä¢ —Ñ–∏—Ä–º–∞‚Äë—Å–µ–ª–µ–∫—Ç–æ—Ä ‚Ä¢ –ø–æ–∏—Å–∫ ‚Ä¢ –∞–≤–∞—Ç–∞—Ä
Sidebar: –ü—Ä–æ–µ–∫—Ç—ã / –ö–ª–∏–µ–Ω—Ç—ã / –ë—Ä–∏–≥–∞–¥—ã / (–ê–¥–º–∏–Ω) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –§–∏—Ä–º—ã
–ö–æ–Ω—Ç–µ–Ω—Ç: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏ —Ñ–æ—Ä–º—ã
```

### 5.2 –≠–∫—Ä–∞–Ω ¬´–ü—Ä–æ–µ–∫—Ç—ã¬ª  (PL‚Äë—Ä–µ–∂–∏–º)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç           | –î–µ–π—Å—Ç–≤–∏–µ                                                                      |
| ------------------- | ----------------------------------------------------------------------------- |
| –§–∏–ª—å—Ç—Ä‚Äë–ø–∞–Ω–µ–ª—å       | –∫–ª–∏–µ–Ω—Ç ‚Ä¢ —Å—Ç–∞—Ç—É—Å ‚Ä¢ –±—Ä–∏–≥–∞–¥–∞ ‚Ä¢ –¥–∞—Ç—ã                                              |
| –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤    | –∫–æ–ª–æ–Ω–∫–∏: –∫–ª–∏–µ–Ω—Ç, –¥–∞—Ç—ã, –±—Ä–∏–≥–∞–¥–∞, —Å—É–º–º–∞, **—Å—Ç–∞—Ç—É—Å‚Äëbadge**, ‚Ññ —Å—á—ë—Ç–∞ + PDF‚Äë–∏–∫–æ–Ω–∫–∞ |
| ‚ûï ¬´–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç¬ª | –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–∞—Å—Ç–µ—Ä‚Äë—Ñ–æ—Ä–º—É —Å–æ –≤–∫–ª–∞–¥–∫–∞–º–∏ ¬´–û—Å–Ω–æ–≤–Ω–æ–µ / –£—Å–ª—É–≥–∏ / –§–∞–π–ª—ã / –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ¬ª  |
| ¬´–í—ã—Å—Ç–∞–≤–∏—Ç—å —Å—á—ë—Ç¬ª    | –¥–æ—Å—Ç—É–ø–Ω–∞, –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å = `done`, —É—Å–ª—É–≥ >0                                      |
| ¬´–û–ø–ª–∞—á–µ–Ω¬ª           | –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –µ—Å–ª–∏ —Å—á—ë—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω (–∞–¥–º–∏–Ω/—Ñ–∏—Ä–º–∞)                                 |

### 5.3 –≠–∫—Ä–∞–Ω ¬´–ë—Ä–∏–≥–∞–¥—ã¬ª

–¢–∞–±–ª–∏—Ü–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö, –∫–Ω–æ–ø–∫–∞ **–¥–æ–±–∞–≤–∏—Ç—å**, –∞—Ä—Ö–∏–≤‚Äë—Ç—É–º–±–ª–µ—Ä. –ï—Å–ª–∏ —É –±—Ä–∏–≥–∞–¥—ã –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã¬†‚Äî –∫–Ω–æ–ø–∫–∞ –∞—Ä—Ö–∏–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞.

### 5.4 –≠–∫—Ä–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

‚Äë –î–∞—à–±–æ—Ä–¥ KPI, –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞, —ç–∫—Å–ø–æ—Ä—Ç.
‚Äë –ú–µ–Ω—é ¬´–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏¬ª –∏ ¬´–§–∏—Ä–º—ã¬ª —Å CRUD‚Äë–æ–∫–Ω–∞–º–∏.

---

## 6. –õ–æ–≥–∏–∫–∞ –±–∏–∑–Ω–µ—Å‚Äë–ø—Ä–æ—Ü–µ—Å—Å–æ–≤

1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞** ‚Üí —Å—Ç–∞—Ç—É—Å `in_progress`.
2. **–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Å–ª—É–≥, —Ñ–∞–π–ª–æ–≤**.
3. **–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ¬´–ó–∞–≤–µ—Ä—à—ë–Ω¬ª** ‚Üí —Å—Ç–∞—Ç—É—Å `done`.
4. **–ö–Ω–æ–ø–∫–∞ ¬´–í—ã—Å—Ç–∞–≤–∏—Ç—å —Å—á—ë—Ç¬ª** ‚Üí `/api/invoice/create`, —Å—Ç–∞—Ç—É—Å `invoiced`.
5. **–û–ø–ª–∞—Ç–∞** ‚Üí –∞–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–û–ø–ª–∞—á–µ–Ω¬ª ‚Üí —Å—Ç–∞—Ç—É—Å `paid`.

–¢—Ä–∏–≥–≥–µ—Ä Postgres `AFTER UPDATE projects.status` –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ `invoice_queue`; –≤–æ—Ä–∫–µ—Ä —Å–µ—Ä–≤–µ—Ä–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

## 7. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –æ—Ç—á—ë—Ç—ã

| –°–æ–±—ã—Ç–∏–µ                   | –ö–∞–Ω–∞–ª                                     |
| ------------------------- | ----------------------------------------- |
| –°—á—ë—Ç —Å–æ–∑–¥–∞–Ω               | Toast + Email PL                          |
| –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞ >N –¥–Ω–µ–π | Email –∞–¥–º–∏–Ω—É + Leiter                     |
| –û—à–∏–±–∫–∞ Ninja              | Email dev‚Äëops + –∑–∞–ø–∏—Å—å –≤ `invoice_errors` |

–≠–∫—Å–ø–æ—Ä—Ç CSV/Excel: ¬´–†–µ–µ—Å—Ç—Ä —Å—á–µ—Ç–æ–≤¬ª, ¬´–°–≤–æ–¥–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤¬ª, ¬´–ù–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ¬ª.

---

## 8. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

* RLS –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º/—Ñ–∏—Ä–º–∞–º.
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ Ninja (KMS/pgcrypto).
* JWT —Å—Ä–æ–∫ 24‚ÄØ—á, refresh‚Äërotation.
* Rate‚Äëlimit –∫–Ω–æ–ø–∫–∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á—ë—Ç–∞ (1 –≤—ã–∑–æ–≤‚ÄØ/‚ÄØ–º–∏–Ω).
* S3‚Äë—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ñ–∞–π–ª–æ–≤, nightly pg‚Äëdump + —Ñ–∞–π–ª–æ–≤—ã–π backup.
* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–µ–Ω–¥–∞, –∫—ç—à –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤.

---

**–î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≤–µ—Ä—à—ë–Ω ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö, —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ UX‚Äë–æ–ø–∏—Å–∞–Ω–∏–µ.**
