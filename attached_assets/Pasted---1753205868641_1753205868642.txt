Ниже — формулировка «высоким» (торжественно-официальным) стилем для ИИ-агента, отвечающего за открытие и отображение файлов (изображений и PDF) из хранилища.

---

### Инструкция для интеллектуального модуля доступа к файлам

**Цель:**
Обеспечить корректное, безопасное и удобочитаемое открытие файлов типов «изображение» (JPEG/PNG/WebP и др.) и «документ PDF», хранящихся во внешнем или внутреннем файловом сторедже, с последующим представлением их пользователю.

---

#### 1. Определение и валидация запроса

1.1. Зафиксировать идентификатор файла (путь, UUID, ключ объекта в облаке, временная ссылка и пр.), переданный пользователем или вышестоящей подсистемой.
1.2. Уточнить требуемые операции (просмотр, скачивание, извлечение метаданных, генерация превью и т. п.).
1.3. Проверить полномочия запрашивающей стороны (токен, скоуп, ACL). При отсутствии — инициировать процедуру отказа или запроса авторизации.

---

#### 2. Получение файла из хранилища

2.1. Сформировать безопасный канал доступа (временная URL, подписанный запрос, прямое чтение по API).
2.2. Выполнить загрузку в потоковом режиме, избегая нерационального использования памяти.
2.3. Верифицировать целостность и тип файла (MIME, сигнатуры). При расхождении объявленного и фактического типов — прервать операцию с документированным уведомлением.

---

#### 3. Обработка изображений

3.1. Если формат поддерживается напрямую, отдать файл в исходном виде или конвертировать в универсальный (например, PNG/JPEG) при необходимости.
3.2. Сгенерировать эскизы (thumbnails) и, при запросе, варианты сжатия/ресайза.
3.3. Сохранить EXIF-метаданные или удалить их согласно политике приватности.

---

#### 4. Обработка PDF-документов

4.1. Извлечь количество страниц, размеры и встроенные шрифты.
4.2. По требованию — отрендерить отдельные страницы в растровые изображения для предпросмотра.
4.3. Поддержать частичную загрузку (range requests) и навигацию по страницам.
4.4. Предусмотреть извлечение текста (OCR при необходимости) и закладок, если это запрошено.

---

#### 5. Представление результата пользователю

5.1. Выбрать формат вывода, сообразный среде (веб-вьювер, встроенный просмотрщик, ссылка на скачивание).
5.2. Обеспечить доступность (alt-тексты для изображений, текстовые версии PDF).
5.3. Сообщить о размере файла, количестве страниц, дате модификации и ином релевантном метаданных.

---

#### 6. Обработка ошибок и исключений

6.1. Классифицировать ошибки (авторизация, отсутствующий файл, повреждённый формат, превышение лимитов).
6.2. Возвращать структурированные сообщения с кодами и рекомендациями.
6.3. Логировать инциденты с учётом требований безопасности и конфиденциальности.

---

#### 7. Оптимизация и безопасность

7.1. Кэшировать часто запрашиваемые объекты и превью при соблюдении политик протухания (TTL).
7.2. Исключить передачу вредоносного содержимого (сканирование на вирусы/скрипты).
7.3. Минимизировать задержки путём параллельной обработки и ленивой загрузки.

---

#### 8. Завершение транзакции

8.1. Подтвердить успешную операцию пользователю/системе.
8.2. Освободить временные ресурсы (буферы, временные файлы).
8.3. При необходимости — обновить аудит-трейл и статистику обращений.

---

**Настоящая инструкция подлежит неукоснительному исполнению и может быть расширена с учётом особенностей целевой инфраструктуры и требований информационной безопасности.**

Если нужно адаптировать текст под конкретный стек (S3/GCS/Azure Blob, конкретный фреймворк, язык программирования) — сообщите детали, я уточню формулировки.
